import webbrowser
from kivymd.app import MDApp
from kivymd.uix.screen import Screen
from kivy.lang import Builder
from kivymd.uix.label import MDLabel
from kivymd.uix.button import MDRectangleFlatButton, MDIconButton
from kivy.core.window import Window
from bidi.algorithm import get_display
from kivy.uix.image import Image
from arabic_reshaper import reshape
from kivymd.uix.screenmanager import ScreenManager
import subprocess  # استيراد وحدة subprocess لتشغيل ملفات خارجية

Window.size = (400, 600)
image = '''
Image:
    source: 'img/A.png'
    pos_hint: {'center_x': 0.5, 'center_y': 0.8}
    size_hint: (0.5, 0.5)
'''

class DemoAPP(MDApp):
    def build(self):
        self.title = 'Karar Nasser Saad'
        self.theme_cls.primary_palette = "Blue"
        self.theme_cls.primary_hue = "600"
        self.theme_cls.theme_style = "Light"

        # إنشاء ScreenManager لإدارة الشاشات
        screen_manager = ScreenManager()

        # الشاشة الرئيسية
        main_screen = Screen()
        main_screen.name = "main"

        # النص العربي مع إعادة تشكيله
        arabic_text = "Al-Amarah University College\n \n Create identities"
        reshaped_text = get_display(reshape(arabic_text))  # إعادة تشكيل النص العربي

        # إنشاء MDLabel مع النص العربي المعاد تشكيله
        label = MDLabel(
            text=reshaped_text,
            halign="center",
            theme_text_color="Primary",
            font_style="H5",
            pos_hint={'center_x': 0.5, 'center_y': 0.5},
            font_name="C:/Windows/Fonts/Arial.ttf"
        )

        # زر "دخول"
        btn_flat = MDRectangleFlatButton(
            text='Login',
            pos_hint={'center_x': 0.5, 'center_y': 0.3},
            size_hint=(0.6, .1)
        )
        btn_flat.bind(on_release=self.on_login_press)

        # استخدام BoxLayout لتوزيع الأيقونات بشكل متساوي
        icon_buttons = [
            {"icon": "facebook", "color": (0, 0, 1, 1), "url": "https://www.facebook.com/alamarahuc"},
            {"icon": "instagram", "color": (0.88, 0.19, 0.42, 1), "url": "https://www.instagram.com/alamarahuc/"},
            {"icon": "youtube", "color": (1, 0, 0, 1), "url": "https://www.youtube.com/channel/UCJOznY9lRszhtHQcB4oS4Qg"},
            {"icon": "web", "color": (0.0, 0.5, 0.0, 1), "url": "https://alamarahuc.edu.iq/"}
        ]

        icon_layout = Builder.load_string('''
BoxLayout:
    orientation: 'horizontal'
    size_hint_y: None
    height: "50dp"
    spacing: "10dp"
    pos_hint: {"center_x": 0.6, "center_y": 0.1}
    padding: ["10dp", "10dp", "10dp", "10dp"]
''')

        for button in icon_buttons:
            icon_btn = MDIconButton(
                icon=button["icon"],
                size_hint=(None, None),
                size=("40dp", "40dp"),
                theme_text_color="Custom",
                text_color=button["color"],
                icon_size="30sp"
            )
            if "url" in button:
                icon_btn.bind(on_press=lambda instance, url=button["url"]: webbrowser.open(url))
            icon_layout.add_widget(icon_btn)

        main_screen.add_widget(btn_flat)
        main_screen.add_widget(icon_layout)
        main_screen.add_widget(Builder.load_string(image))
        main_screen.add_widget(label)

        screen_manager.add_widget(main_screen)
        return screen_manager

    def on_login_press(self, instance):
        self.stop()  # إغلاق التطبيق الحالي
        subprocess.call(["python", "main2.py"])  # تشغيل الملف الثاني

if __name__ == '__main__':
    DemoAPP().run()
